# Input: s3_nonrecursive_lateral_topn.sql
SELECT n.id, top_edges.to_id, top_edges.weight
FROM nodes n
JOIN LATERAL (
  SELECT to_id, weight
  FROM edges e
  WHERE e.from_id = n.id
  ORDER BY weight DESC
  LIMIT 2
) top_edges ON TRUE
WHERE n.id IN (1,2);

# Output:
SELECT n.id, top_edges.to_id, top_edges.weight
FROM nodes n
JOIN LATERAL (
  SELECT to_id, weight
  FROM edges e
  WHERE e.from_id = n.id
  ORDER BY weight DESC
  LIMIT 2
) top_edges ON TRUE
WHERE n.id IN (1,2);
 id | to_id | weight 
----+-------+--------
  1 |    10 |     50
  1 |    11 |     40
  2 |    20 |     99
  2 |    21 |     10
(4 rows)

